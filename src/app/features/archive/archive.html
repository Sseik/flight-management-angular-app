<div class="archive-container">
  <h2>üóÑÔ∏è –ê—Ä—Ö—ñ–≤ —Ç–∞ –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞</h2>

  <div class="tabs">
    <button [class.active]="activeTab === 'archive'" (click)="activeTab = 'archive'">–ê—Ä—Ö—ñ–≤—É–≤–∞–Ω–Ω—è</button>
    <button [class.active]="activeTab === 'analytics'" (click)="activeTab = 'analytics'">–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ (–ó–∞–≤–¥–∞–Ω–Ω—è 5)</button>
  </div>

  @if (activeTab === 'archive') {
    <div class="controls card">
        <h3>1. –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö (PostgreSQL -> MongoDB)</h3>
        <div class="flex-row">
            <label>–ó: <input type="date" [(ngModel)]="fromDate"></label>
            <label>–ü–æ: <input type="date" [(ngModel)]="toDate"></label>
            <button (click)="runArchive()" [disabled]="isLoading">
            {{ isLoading ? '‚è≥ –û–±—Ä–æ–±–∫–∞...' : 'üöÄ –ê—Ä—Ö—ñ–≤—É–≤–∞—Ç–∏' }}
            </button>
        </div>
        @if (resultMessage) {
            <p [class.success]="isSuccess" class="msg">{{ resultMessage }}</p>
        }
    </div>

    <div class="view-panel card">
        <div class="flex-row" style="justify-content: space-between;">
            <h3>2. –ü–µ—Ä–µ–≥–ª—è–¥ –ê—Ä—Ö—ñ–≤—É</h3>
            <button (click)="loadArchive()" class="refresh-btn">üîÑ –û–Ω–æ–≤–∏—Ç–∏</button>
        </div>
        <table class="archive-table">
            <thead>
                <tr>
                    <th>–î–∞—Ç–∞</th><th>–†–µ–π—Å</th><th>–ê–≤—ñ–∞–∫–æ–º–ø–∞–Ω—ñ—è</th><th>–ú–∞—Ä—à—Ä—É—Ç</th><th>–ü–∞—Å.</th>
                </tr>
            </thead>
            <tbody>
                @for (doc of archivedList; track doc._id) {
                <tr>
                    <td>{{ doc.archivedAt | date:'shortDate' }}</td>
                    <td><strong>{{ doc.flightNumber }}</strong> <span [class]="'badge ' + doc.status">{{ doc.status }}</span></td>
                    <td>{{ doc.airline.name }}</td>
                    <td>{{ doc.route.origin.city }} ‚ûù {{ doc.route.destination.city }}</td>
                    <td>{{ doc.passengerManifest.length }}</td>
                </tr>
                }
            </tbody>
        </table>
    </div>
  }

  @if (activeTab === 'analytics') {
    <div class="card">
        <div class="analytics-buttons">
            <button (click)="runAnalytics('A')">–ê) –§—ñ–ª—å—Ç—Ä + –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è</button>
            <button (click)="runAnalytics('B')">–ë) –ê–≥—Ä–µ–≥–∞—Ü—ñ—è (Group)</button>
            <button (click)="runAnalytics('C')">–í) –ó'—î–¥–Ω–∞–Ω–Ω—è (Lookup)</button>
        </div>

        @if (analyticsResult && analyticsResult.length > 0) {
            <div class="results-area">
                <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç: {{ queryTitle }}</h3>
                <pre>{{ analyticsResult | json }}</pre>
                
                <table class="archive-table">
                    <thead>
                        <tr>
                            @for (item of asRecord(analyticsResult[0]) | keyvalue; track item.key) {
                                <th>{{ item.key }}</th>
                            }
                        </tr>
                    </thead>
                    <tbody>
                        @for (row of analyticsResult; track $index) {
                            <tr>
                                @for (item of asRecord(row) | keyvalue; track item.key) {
                                    <td>{{ formatValue(item.value) }}</td>
                                }
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
  }
</div>